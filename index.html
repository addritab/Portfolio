<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Addrita Biswas</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./frames.js"></script>

  <style>
    #trace {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    white-space: pre;
    user-select: none;
    text-align: left;
    margin: 0;
    cursor: pointer;
    transform-origin: center center;
    }


    .light-mode {
      background: white;
      color: black;
    }

    .light-mode #trace {
      color: black;
    }

    .light-mode .nav,
    .light-mode .idblock {
      color: black;
    }
  </style>
</head>

<body id="page" class="bg-[#131313] text-white overflow-hidden">
  <main class="relative h-screen w-screen">

    <!-- Top navigation -->
    <div class="nav absolute top-8 left-12 right-12 flex justify-between text-[18px] text-white opacity-70">
      <span class="tracking-wide cursor-pointer hover:text-white transition">&lt; about &gt;</span>
      <span class="tracking-wide cursor-pointer hover:text-white transition">&lt; projects &gt;</span>
    </div>

    <!-- Cat wrapper (position knobs here) -->
    <div
      id="catWrap"
      class="absolute left-[60%] top-[45%] -translate-x-1/2 -translate-y-1/2 w-[92vw] max-w-[820px]"
    >
      <pre id="trace"><span id="trace-chars"></span></pre>
    </div>

    <!-- Bottom-left identity -->
    <section class="idblock absolute left-12 bottom-16 max-w-[80vw] font-[Arial]">
    <h1 class="text-[40px] leading-tight font-[Arial] font-light"> addrita biswas</h1>
    <p class="mt-2 text-sm opacity-50">
        addritaside [at] gmail [dot] com
    </p>

    <!-- Grouped block -->
    <p class="mt-4 text-sm opacity-70 underline decoration-dotted decoration-current/40 underline-offset-4">
    swe, design, &amp; writing
    </p>

    <p class="mt-1 text-sm opacity-70">
        student engineer alum @ google code next
    </p>

    <p class="mt-1 text-sm opacity-70">
        computer science @ sbu
    </p>
    </section>

  </main>

  <script>
    var pre = document.getElementById('trace');
    var page = document.getElementById('page');

    var i = -1;
    var dir = 'inc';
    var max = frames.length;
    var fps = 35;
    var SCALE = 0.55;
    var isLight = false;

    // Subtle, sharp hover grow
    pre.addEventListener("mouseenter", () => {
      pre.style.transform = "scale(1.01)";
    });

    pre.addEventListener("mouseleave", () => {
      pre.style.transform = "scale(1)";
    });

    // Click toggle dark / light
    pre.addEventListener("click", () => {
      isLight = !isLight;
      page.classList.toggle("light-mode", isLight);
      page.classList.toggle("bg-[#131313]", !isLight);
      page.classList.toggle("bg-white", isLight);
      page.classList.toggle("text-white", !isLight);
      page.classList.toggle("text-black", isLight);
    });

    setPreCharSize();
    startAnimating();
    window.addEventListener('resize', setPreCharSize);

    function setPreCharSize() {
      var charRatio = 0.66;
      var sampleLine = frames[0].split('\n')[1] || frames[0];

      var charWidth = fitTextToContainer(
        sampleLine,
        getComputedStyle(pre).fontFamily,
        pre.clientWidth
      ) * charRatio;

      var charHeight = charRatio * charWidth;

      pre.style.fontSize = (charWidth * SCALE) + "px";
      pre.style.lineHeight = (charHeight * SCALE) + "px";
    }

    var fpsInterval, then;
    function startAnimating() {
      fpsInterval = 1000 / fps;
      then = Date.now();
      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      var now = Date.now();
      var elapsed = now - then;
      if (elapsed > fpsInterval) {
        then = now - (elapsed % fpsInterval);
        step();
      }
    }

    function step() {
      if (dir === 'inc') {
        if (i === max - 1) { dir = 'dec'; i--; }
        else { i++; }
      } else {
        if (i === 0) { dir = 'inc'; i++; }
        else { i--; }
      }
      document.getElementById('trace-chars').innerText = frames[i];
    }

    function fitTextToContainer(text, fontFace, containerWidth) {
      const PIXEL_RATIO = getPixelRatio();
      let canvas = createHiDPICanvas(containerWidth, 0),
          context = canvas.getContext('2d'),
          longestLine = getLongestLine(split(text)),
          fittedFontSize = getFittedFontSize(longestLine, fontFace);
      return fittedFontSize;

      function getPixelRatio() {
        let ctx = document.createElement("canvas").getContext("2d"),
            dpr = window.devicePixelRatio || 1,
            bsr = ctx.webkitBackingStorePixelRatio ||
                  ctx.mozBackingStorePixelRatio ||
                  ctx.msBackingStorePixelRatio ||
                  ctx.oBackingStorePixelRatio ||
                  ctx.backingStorePixelRatio || 1;
        return dpr / bsr;
      }

      function split(text) { return text.split('\n'); }

      function getLongestLine(lines) {
        let longest = -1, idx;
        lines.forEach((line, ii) => {
          let lineWidth = context.measureText(line).width;
          if (lineWidth > longest) {
            idx = ii;
            if (!line.includes('exempt-from-text-fit-calculation')) {
              longest = lineWidth;
            }
          }
        });
        return (typeof idx === 'number') ? lines[idx] : null;
      }

      function getFittedFontSize(text, fontFace) {
        const fits = () => context.measureText(text).width <= canvas.width;
        const font = (size, face) => size + "px " + face;
        let fontSize = 300;
        do {
          fontSize--;
          context.font = font(fontSize, fontFace);
        } while(!fits());
        fontSize /= (PIXEL_RATIO / 1.62);
        return fontSize;
      }

      function createHiDPICanvas(w, h) {
        let canvas = document.createElement("canvas");
        canvas.width = w * PIXEL_RATIO;
        canvas.height = h * PIXEL_RATIO;
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        canvas.getContext("2d").setTransform(PIXEL_RATIO, 0, 0, PIXEL_RATIO, 0, 0);
        return canvas;
      }
    }
  </script>
</body>
</html>
